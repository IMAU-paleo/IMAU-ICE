# Compiler
# ========

# If you got gfotran and OpenMPI, then you got mpifort.
  F90 = mpifort

# Library paths
# =============

# These variables should point to the include and lib
# directories of each of the required external libraries.
#
# "include" paths should be prefixed with -I
#
# "lib" paths should be prefixed with -L, and after them
# the name of the corresponding library file.
#
# If you got nc-config, nf-config, or pkg-config, those can
# do that job for you. If you do not, here is an example of
# manually adding the paths:
#
# NCINC     = -I/my_path/netcdf/include
# NCLIB     = -L/my_path/netcdf/lib -lnetcdf
# NFINC     = -I/my_path/netcdf-fortran/include
# NFLIB     = -L/my_path/netcdf-fortran/lib -lnetcdff
# PETSCINC  = -I/my_path/petsc/include
# PETSCLIB  = -L/my_path/petsc/lib -lpetsc
# LAPACKINC = -I/my_path/lapack/include
# LAPACKLIB = -L/my_path/lapack/lib -llapack
#
# NOTE for Snellius: When you load the modules on Snellius for
# each of the required libraries, those are automatically added
# to your PATH and LD_LIBRARY_PATH variables, plus other variables
# pointing to those libraries. Thus, your terminal will have no
# issue finding the files even if you do not define their paths
# here explicitly. That's why the variables for PETSc and LAPACK
# below are either empty, use some already existing variable,
# or contain just the name/flag of the target library file.

# NetCDF and NetCDF-Fortran
  NCINC     = $(shell nc-config --cflags)
  NCLIB     = $(shell nc-config --libs)
  NFINC     = $(shell nf-config --fflags)
  NFLIB     = $(shell nf-config --flibs)

# PETSc
  PETSCINC  = -I${PETSC_DIR}/include
  PETSCLIB  = -L${PETSC_DIR}/lib -lpetsc

# LAPACK: for Snellius, the simplest is to load the OpenBlas
# module and then use that library as your LAPACK implementation.
  LAPACKINC =
  LAPACKLIB = -lopenblas

# SELEN
# =====

# Compile with SELEN: anything else than yes (no quotes) will skip all
# SELEN-related stuff both in the Makefile and in the model code
  DO_SELEN = no

# Compiler flags
# ==============

# ---
# From this line on your settings above will be put together
# and later used to compile the model code. If you get errors,
# it is very likely something in the lines above is missing.
# ---

# SELEN:
  ifeq ($(DO_SELEN),yes)
    COMPILER_FLAGS_SELEN = -DDO_SELEN
  endif

# Basic flags:
  COMPILER_FLAGS_BASIC   = -O3 -J${MOD_PATH} -Wall -ffree-line-length-none -cpp \
                           -g # -Werror=implicit-interface

# Check flags:
  COMPILER_FLAGS_CHECK   = -fcheck=all -fbacktrace -fimplicit-none

# Library flags:
  COMPILER_FLAGS_INCLS   = ${NCINC} ${NFINC} ${PETSCINC} ${LAPACKINC}

# Final list
  F90FLAGS               = ${COMPILER_FLAGS_BASIC} ${COMPILER_FLAGS_CHECK} \
                           ${COMPILER_FLAGS_SELEN} ${COMPILER_FLAGS_INCLS}

# Library linking
# ===============

  LDFLAGS                = ${NCLIB} ${NFLIB} ${PETSCLIB} ${LAPACKLIB}